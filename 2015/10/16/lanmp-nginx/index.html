<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Lanmp服务器环境搭建 – Nginx · 小白巷</title><meta name="description" content="Nginx安装
下载 nginx 源码包http://nginx.org/en/download.html
源码安装nginx
tar zxvf nginx-1.0.15.tar.gzcd nginx-1.0.15&lt;h1 id=&quot;yum_install_pcre-devel_perl-devel_p"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="http://weibo.com/jorycn" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="https://github.com/jorycn" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Lanmp服务器环境搭建 – Nginx</h1><div class="post-meta"><div class="post-time">2015年10月16日</div></div><div class="post-content"><h4 id="Nginx_u5B89_u88C5"><a href="#Nginx_u5B89_u88C5" class="headerlink" title="Nginx安装"></a>Nginx安装</h4><ol>
<li>下载 nginx 源码包<a href="http://nginx.org/en/download.html" target="_blank" rel="external">http://nginx.org/en/download.html</a></li>
<li><p>源码安装nginx</p>
<h1 id="tar_zxvf_nginx-1-0-15-tar-gz"><a href="#tar_zxvf_nginx-1-0-15-tar-gz" class="headerlink" title="tar zxvf nginx-1.0.15.tar.gz"></a>tar zxvf nginx-1.0.15.tar.gz</h1><h1 id="cd_nginx-1-0-15"><a href="#cd_nginx-1-0-15" class="headerlink" title="cd nginx-1.0.15"></a>cd nginx-1.0.15</h1><h1 id="yum_install_pcre-devel_perl-devel_perl-ExtUtils-Embed_openssl_openssl-devel_-y"><a href="#yum_install_pcre-devel_perl-devel_perl-ExtUtils-Embed_openssl_openssl-devel_-y" class="headerlink" title="yum install pcre-devel perl-devel perl-ExtUtils-Embed openssl openssl-devel -y"></a>yum install pcre-devel perl-devel perl-ExtUtils-Embed openssl openssl-devel -y</h1><h1 id="/configure__u2013user_3Dwww__u2013group_3Dwww__u2013prefix_3D/usr/local/nginx__u2013conf-path_3D/usr/local/nginx/conf/nginx-conf__u2013pid-path_3D/usr/local/nginx/run/nginx-pid__u2013lock-path_3D/usr/local/nginx/lock/nginx__u2013with-http_ssl_module__u2013with-http_realip_module__u2013with-http_addition_module__u2013with-http_sub_module__u2013with-http_dav_module__u2013with-http_flv_module__u2013with-http_gzip_static_module__u2013with-http_stub_status_module__u2013with-http_perl_module__u2013with-mail__u2013with-mail_ssl_module"><a href="#/configure__u2013user_3Dwww__u2013group_3Dwww__u2013prefix_3D/usr/local/nginx__u2013conf-path_3D/usr/local/nginx/conf/nginx-conf__u2013pid-path_3D/usr/local/nginx/run/nginx-pid__u2013lock-path_3D/usr/local/nginx/lock/nginx__u2013with-http_ssl_module__u2013with-http_realip_module__u2013with-http_addition_module__u2013with-http_sub_module__u2013with-http_dav_module__u2013with-http_flv_module__u2013with-http_gzip_static_module__u2013with-http_stub_status_module__u2013with-http_perl_module__u2013with-mail__u2013with-mail_ssl_module" class="headerlink" title="./configure –user=www –group=www –prefix=/usr/local/nginx –conf-path=/usr/local/nginx/conf/nginx.conf –pid-path=/usr/local/nginx/run/nginx.pid –lock-path=/usr/local/nginx/lock/nginx –with-http_ssl_module –with-http_realip_module –with-http_addition_module –with-http_sub_module –with-http_dav_module –with-http_flv_module –with-http_gzip_static_module –with-http_stub_status_module –with-http_perl_module –with-mail –with-mail_ssl_module"></a>./configure –user=www –group=www –prefix=/usr/local/nginx –conf-path=/usr/local/nginx/conf/nginx.conf –pid-path=/usr/local/nginx/run/nginx.pid –lock-path=/usr/local/nginx/lock/nginx –with-http_ssl_module –with-http_realip_module –with-http_addition_module –with-http_sub_module –with-http_dav_module –with-http_flv_module –with-http_gzip_static_module –with-http_stub_status_module –with-http_perl_module –with-mail –with-mail_ssl_module</h1><p>`</p>
</li>
<li><p>make &amp;&amp;　make install</p>
<h4 id="u670D_u52A1_u914D_u7F6E"><a href="#u670D_u52A1_u914D_u7F6E" class="headerlink" title="服务配置"></a>服务配置</h4><pre>`# groupadd www
# useradd -g www -s /sbin/nologin -M www
# /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf     
`</pre>

<h4 id="u542F_u52A8_u811A_u672C/_u91CD_u542F_u811A_u672C"><a href="#u542F_u52A8_u811A_u672C/_u91CD_u542F_u811A_u672C" class="headerlink" title="启动脚本/重启脚本"></a>启动脚本/重启脚本</h4></li>
<li><p>编写脚本</p>
<pre>`vi /etc/rc.d/init.d/nginx
添加以下内容
#!/bin/sh
#
# nginx - this script starts and stops the nginx daemin
#
# chkconfig:   - 85 15
# description:  Nginx is an HTTP(S) server, HTTP(S) reverse \
#               proxy and IMAP/POP3 proxy server
# processname: nginx
# config:      /usr/local/nginx/conf/nginx.conf
# pidfile:     /usr/local/nginx/logs/nginx.pid
# Source function library.
. /etc/rc.d/init.d/functions
# Source networking configuration.
. /etc/sysconfig/network
# Check that networking is up.
[ "$NETWORKING" = "no" ] &amp;&amp; exit 0
nginx="/usr/local/nginx/sbin/nginx"
prog=$(basename $nginx)
NGINX_CONF_FILE="/usr/local/nginx/conf/nginx.conf"
lockfile=/var/lock/subsys/nginx
start() {
  [ -x $nginx ] || exit 5
  [ -f $NGINX_CONF_FILE ] || exit 6
  echo -n $"Starting $prog: "
  daemon $nginx -c $NGINX_CONF_FILE
  retval=$?
  echo
  [ $retval -eq 0 ] &amp;&amp; touch $lockfile
  return $retval
}
stop() {
  echo -n $"Stopping $prog: "
  killproc $prog -QUIT
  retval=$?
  echo
  [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile
  return $retval
}
restart() {
  configtest || return $?
  stop
  start
}
reload() {
  configtest || return $?
  echo -n $"Reloading $prog: "
  killproc $nginx -HUP
  RETVAL=$?
  echo
}
force_reload() {
  restart
}
configtest() {
$nginx -t -c $NGINX_CONF_FILE
}
rh_status() {
  status $prog
}
rh_status_q() {
  rh_status &gt;/dev/null 2&gt;&amp;1
}
case "$1" in
  start)
      rh_status_q &amp;&amp; exit 0
      $1
      ;;
  stop)
      rh_status_q || exit 0
      $1
      ;;
  restart|configtest)
      $1
      ;;
  reload)
      rh_status_q || exit 7
      $1
      ;;
  force-reload)
      force_reload
      ;;
  status)
      rh_status
      ;;
  condrestart|try-restart)
      rh_status_q || exit 0
          ;;
  *)
      echo $"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}"
      exit 2
esac
`</pre></li>
<li><p>配置权限</p>
<pre>`chmod +x /etc/rc.d/init.d/nginx
/sbin/chkconfig nginx on
`</pre>

<h4 id="u542F_u7528php_u811A_u672C_28_u5B89_u88C5php_u4E4B_u540E_u518D_u64CD_u4F5C_29_3A"><a href="#u542F_u7528php_u811A_u672C_28_u5B89_u88C5php_u4E4B_u540E_u518D_u64CD_u4F5C_29_3A" class="headerlink" title="启用php脚本(安装php之后再操作):"></a>启用php脚本(安装php之后再操作):</h4></li>
<li><p>独立虚拟主机目录</p>
<pre>`# vi /usr/local/nginx/conf/nginx.conf
:set nu
将第 35行到79 行注释掉
:35,79 s/^/#/g
在配置文件倒数第二行添加内容：
include /usr/local/nginx/conf/conf.d/*.conf;
`</pre></li>
<li>创建 vhost配置文件所在的目录<pre>`# mkdir /usr/local/nginx/conf/conf.d/
# vi default.conf
server {
    listen       80;
    server_name localhost;
    location / {
        root   /www/default;
        index  index.php index.html index.htm;
    }
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /www/default;
    }
    location ~ \.php$ {
        root          /www/default;
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }
}
`</pre></li>
<li>创建站点目录<pre>`# mkdir /www/default
`</pre></li>
<li>重启php和nginx<br><pre>`# service php-fpm restart<h1 id="ps_-ef_7Cgrep_nginx_7Cawk__u2018_7Bprint__242_7D_u2019_7Cxargs_kill_-9"><a href="#ps_-ef_7Cgrep_nginx_7Cawk__u2018_7Bprint__242_7D_u2019_7Cxargs_kill_-9" class="headerlink" title="ps -ef|grep nginx|awk ‘{print $2}’|xargs kill -9"></a>ps -ef|grep nginx|awk ‘{print $2}’|xargs kill -9</h1><h1 id="/usr/local/nginx/sbin/nginx_-c_/usr/local/nginx/conf/nginx-conf"><a href="#/usr/local/nginx/sbin/nginx_-c_/usr/local/nginx/conf/nginx-conf" class="headerlink" title="/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf"></a>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</h1></pre></li>
</ol>
</div></article></div></section><footer><div class="paginator"><a href="/2015/10/20/lanmp-php/" class="prev">上一篇</a><a href="/2015/10/16/lanmp-apache/" class="next">下一篇</a></div></footer><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>